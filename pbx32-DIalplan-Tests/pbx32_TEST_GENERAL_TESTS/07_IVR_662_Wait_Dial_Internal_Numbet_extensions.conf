[general]
static = yes
writeprotect = no
autofallthrough = yes
clearglobalvars = yes
priorityjumping = no
extenpatternmatchnew = no
[globals]
TOUCH_MONITOR_FORMAT = wav_alaw
TOUCH_MIXMONITOR_FORMAT = wav_alaw
DIALOPTIONS = tTkKWwXx
PRESS5TOLEVMSG_ENABLE = 0
ABSOLUTE_TIMEOUT = 6000
RINGTIME = 30
TRANSFER_INCOMING_CALLERID = 

BIZHOURS_ENABLE=0
trunk_76 = DAHDI/g34
CID_trunk_76 = 
trunk-E1Trunk1 = DAHDI/g11
CID_trunk-E1Trunk1 = 
trunk-E1Trunk2 = DAHDI/g12
CID_trunk-E1Trunk2 = 

trunk-TG400_20002 = SIP/trunk-TG400_20002
CID_trunk-TG400_20002 = 20002
trunk-TG400_20002-enable = yes
trunk-TG400_20001 = SIP/trunk-TG400_20001
CID_trunk-TG400_20001 = 20001
trunk-TG400_20001-enable = yes
trunk-test = SIP/trunk-test
CID_trunk-test = test
trunk-test-enable = yes
EMAILADDR_257=test@test.com
#include physical-dial.conf

DIALPARAM_OF_EXTEN100=SIP/100
DIALPARAM_OF_EXTEN101=SIP/101
DIALPARAM_OF_EXTEN102=SIP/102
DIALPARAM_OF_EXTEN103=SIP/103
DIALPARAM_OF_EXTEN104=SIP/104
DIALPARAM_OF_EXTEN105=SIP/105
DIALPARAM_OF_EXTEN106=SIP/106
DIALPARAM_OF_EXTEN107=SIP/107
DIALPARAM_OF_EXTEN108=SIP/108
DIALPARAM_OF_EXTEN109=SIP/109
DIALPARAM_OF_EXTEN110=SIP/110
DIALPARAM_OF_EXTEN200=SIP/200
DIALPARAM_OF_EXTEN201=SIP/201
DIALPARAM_OF_EXTEN202=SIP/202
DIALPARAM_OF_EXTEN203=SIP/203
DIALPARAM_OF_EXTEN204=SIP/204
DIALPARAM_OF_EXTEN205=SIP/205
DIALPARAM_OF_EXTEN206=SIP/206
DIALPARAM_OF_EXTEN207=SIP/207
DIALPARAM_OF_EXTEN208=SIP/208
DIALPARAM_OF_EXTEN209=SIP/209
DIALPARAM_OF_EXTEN210=SIP/210
DIALPARAM_OF_EXTEN211=SIP/211
DIALPARAM_OF_EXTEN212=SIP/212
DIALPARAM_OF_EXTEN213=SIP/213
DIALPARAM_OF_EXTEN214=SIP/214
DIALPARAM_OF_EXTEN215=SIP/215
DIALPARAM_OF_EXTEN216=SIP/216
DIALPARAM_OF_EXTEN217=SIP/217
DIALPARAM_OF_EXTEN218=SIP/218
DIALPARAM_OF_EXTEN219=SIP/219
DIALPARAM_OF_EXTEN220=SIP/220
DIALPARAM_OF_EXTEN221=SIP/221
DIALPARAM_OF_EXTEN222=SIP/222
DIALPARAM_OF_EXTEN223=SIP/223
DIALPARAM_OF_EXTEN224=SIP/224
DIALPARAM_OF_EXTEN256=SIP/256
DIALPARAM_OF_EXTEN257=SIP/257
DIALPARAM_OF_EXTEN258=IAX2/258
DIALPARAM_OF_EXTEN259=SIP/259&IAX2/259
DIALPARAM_OF_EXTEN602=DAHDI/77
DIALPARAM_OF_EXTEN603=DAHDI/78
DIALPARAM_OF_EXTEN604=DAHDI/75

[Local_Default_CallingRules]
include = set-cf-default
include = en-always-cf
include = dis-always-cf
include = en-busy-cf
include = dis-busy-cf
include = en-noanswer-cf
include = dis-noanswer-cf
include = set-cf-number
include = set-cf-vm
include = en-dnd
include = dis-dnd
include = vmm
include = account-code-check
include = en-force-to-outside
include = dis-force-to-outside
include = en-force-to-inside
include = force-to-businesshours
include = parkedcalls
include = conferences
include = ringgroups
include = voicemenus
include = queues
include = voicemailgroups
include = pagegroups
include = page_an_extension
include = pickup_specific_extension
include = speed-dial-match
include = default
[macro-stdPrivacyexten]
exten => s,1,Dial(${ARG2},20,p)
exten => s,2,Goto(s-${DIALSTATUS},1)
exten => s-NOANSWER,1,Voicemail(u${ARG1})
exten => s-NOANSWER,2,Goto(default,s,1)
exten => s-BUSY,1,Voicemail(b${ARG1})
exten => s-BUSY,2,Goto(default,s,1)
exten => s-DONTCALL,1,Goto(${ARG3},s,1)
exten => s-TORTURE,1,Goto(${ARG4},s,1)
exten => _s-.,1,Goto(s-NOANSWER,1)
exten => a,1,VoicemailMain()
[macro-timecondition]
exten = s,1,GotoIf(${DB(OfficeHours/ForceToOutside)}?s,24:s,2)
exten = s,2,GotoIf($[${TIMECON_ENABLE} = 1]?3:25)
exten = s,3,GotoIfTime(${Mon_am},mon,*,*?${ARG1},${ARG2},${ARG3})
exten = s,4,GotoIfTime(${Mon_pm},mon,*,*?${ARG1},${ARG2},${ARG3})
exten = s,5,GotoIfTime(${Mon_ot},mon,*,*?${ARG1},${ARG2},${ARG3})
exten = s,6,GotoIfTime(${Tue_am},tue,*,*?${ARG1},${ARG2},${ARG3})
exten = s,7,GotoIfTime(${Tue_pm},tue,*,*?${ARG1},${ARG2},${ARG3})
exten = s,8,GotoIfTime(${Tue_ot},tue,*,*?${ARG1},${ARG2},${ARG3})
exten = s,9,GotoIfTime(${Wed_am},wed,*,*?${ARG1},${ARG2},${ARG3})
exten = s,10,GotoIfTime(${Wed_pm},wed,*,*?${ARG1},${ARG2},${ARG3})
exten = s,11,GotoIfTime(${Wed_ot},wed,*,*?${ARG1},${ARG2},${ARG3})
exten = s,12,GotoIfTime(${Thu_am},thu,*,*?${ARG1},${ARG2},${ARG3})
exten = s,13,GotoIfTime(${Thu_pm},thu,*,*?${ARG1},${ARG2},${ARG3})
exten = s,14,GotoIfTime(${Thu_ot},thu,*,*?${ARG1},${ARG2},${ARG3})
exten = s,15,GotoIfTime(${Fri_am},fri,*,*?${ARG1},${ARG2},${ARG3})
exten = s,16,GotoIfTime(${Fri_pm},fri,*,*?${ARG1},${ARG2},${ARG3})
exten = s,17,GotoIfTime(${Fri_ot},fri,*,*?${ARG1},${ARG2},${ARG3})
exten = s,18,GotoIfTime(${Sat_am},sat,*,*?${ARG1},${ARG2},${ARG3})
exten = s,19,GotoIfTime(${Sat_pm},sat,*,*?${ARG1},${ARG2},${ARG3})
exten = s,20,GotoIfTime(${Sat_ot},sat,*,*?${ARG1},${ARG2},${ARG3})
exten = s,21,GotoIfTime(${Sun_am},sun,*,*?${ARG1},${ARG2},${ARG3})
exten = s,22,GotoIfTime(${Sun_pm},sun,*,*?${ARG1},${ARG2},${ARG3})
exten = s,23,GotoIfTime(${Sun_ot},sun,*,*?${ARG1},${ARG2},${ARG3})
exten = s,24,Goto(${ARG4},${ARG5},${ARG6})
exten = s,25,Goto(${ARG1},${ARG2},${ARG3})
[macro-stdexten]
exten = s,1,Set(IsFromOutside=0)
exten = s,2,Gotoif($[${LEN(${FromSystemAlert})}>0]?sys-dial,1)
exten = s,3,GotoIf(${DB_EXISTS(${GETNAMEBYCALLERID(${CALLERID(num)})}/blackwhite)}?s,4:s,5)
exten = s,4,GotoIf( $[${DB_RESULT} = 1]?out_userwhite,1:out_userblack,1)
exten = s,5,GotoIf(${DB_EXISTS(oblacklist/${ARG1})}?Blacklist-Handle,s,1)
exten = s,6,Set(DID_INBOUND_TRUNK_VARIABLE=${IF($[${MACRO_CONTEXT:0:17}=DID_inbound_trunk]?1)})
exten = s,7,GotoIf(${DB_EXISTS(oblacklist/${ARG1})}?Blacklist-Handle,s,1)
exten = s,8,Set(DID_INBOUND_TRUNK_VARIABLE=${IF($[${MACRO_CONTEXT:0:17}=DID_inbound_trunk]?1)})
exten = s,n,Macro(realstexten,${ARG1},${DIALPARAM_OF_EXTEN${ARG1}},${DIALOPTIONS})
exten = sys-dial,1,Macro(sysdial,${DIALPARAM_OF_EXTEN${ARG1}},${RINGTIME},${DIALOPTIONS})
exten = out_userblack,1,GotoIf(${DB_EXISTS(${GETNAMEBYCALLERID(${CALLERID(num)})}/oblack-${ARG1})}?Unknown-Handle,s,1:s,5)
exten = out_userwhite,1,GotoIf(${DB_EXISTS(${GETNAMEBYCALLERID(${CALLERID(num)})}/owhite-${ARG1})}?s,5:Unknown-Handle,s,1)
[macro-stdexten-fromoutside]
exten = s,1,Set(IsFromOutside=1)
exten = s,2,Macro(realstexten,${ARG1},${ARG2},${DIALOPTIONS})
[macro-realstexten]
exten = s,1,Set(DYNAMIC_FEATURES=twstart)
exten = s,2,Set(${IF($[${LEN(${DID_INBOUND_TRUNK_VARIABLE})} > 0]?CDR(userfield)=s)})
exten = s,3,GotoIf(${DB_EXISTS(blacklist/${CALLERID(num)})}?Blacklist-Handle,s,1)
exten = s,4,GotoIf(${DB_EXISTS(${ARG1}/blackwhite)}?s,5:s,6)
exten = s,5,GotoIf( $[${DB_RESULT} = 1]?in_userwhite,1:in_userblack,1)
exten = s,6,Set(TIMEOUT(absolute)=${ABSOLUTE_TIMEOUT})
exten = s,n,GotoIf(${DB_EXISTS(faxexten/${ARG1})}?fax-extens,${ARG1},1)
exten = s,n,Set(CKTSETTRANSFER=0)
exten = s,n,Set(REALARG1=${ARG1})
exten = s,n,GotoIf(${DB(CFA/${REALARG1})}>0?follow-me,1)
exten = s,n,GotoIf(${DB(DND/${REALARG1})}>0?vm-u,1)
exten = s,n,Set(RINGTIME=${IF($[${LEN(${RINGTIME_${REALARG1}})} > 0]?${RINGTIME_${REALARG1}}:${RINGTIME})})
exten = s,n,CktStdCall(srtpfor,${ARG2},novalue)
exten = s,n,Set(_SIPSRTP=${SIPPEER(${CKTSTDCALLRESULT},srtpcapable)})
exten = s,n,Dial(${ARG2},${RINGTIME},${ARG3})
exten = s,n,Goto(s-${DIALSTATUS},1)
exten = s-NOANSWER,1,GotoIf(${DB(CFN/${REALARG1})}>0?follow-me,1:1-out,1)
exten = s-BUSY,1,GotoIf(${DB(CFB/${ARG1})}>0?follow-me-busy,1:1-out,1)
exten = s-ANSWER,1,Hangup
exten = cktcheck,1,Set(CKTSETTRANSFER=0)
exten = cktcheck,4,Hangup()
exten = _s-.,1,GotoIf(${CKTSETTRANSFER}>0?cktcheck,1)
exten = _s-.,n,Goto(s-NOANSWER,1)
exten = follow-me,1,GotoIf(${DB(CFD/${REALARG1})}>0?vm-u,1)
exten = follow-me,2,Set(cfnum=${DB(CF/${REALARG1})})
exten = follow-me,3,GotoIf($[${LEN(${cfnum})}<1]?vm-u,1))
exten = follow-me,4,GotoIf($["${cfnum}" = "${REALARG1}"]?vm-u,1)
exten = follow-me,5,Set(IsFollowme=${IF($[${IsFromOutside} = 1]?1:0)})
exten = follow-me,6,Followme(${REALARG1},n)
exten = follow-me,7,Goto(vm-u,1)
exten = vm-u,1,GotoIf($[${PRESS5TOLEVMSG_ENABLE} = 1]?vm-u,2:vm-unavail,1)
exten = vm-u,n,playback(/var/spool/asterisk/voicemail/default/${REALARG1}/unavail)
exten = vm-u,n,Playback(vm-leavemsg)
exten = vm-u,n,Read(digito,,1,,,3)
exten = vm-u,n,GotoIf($[${digito}=5]?vm-s,1)
exten = vm-u,n,playback(/var/spool/asterisk/voicemail/default/${REALARG1}/unavail)
exten = vm-u,n,Playback(vm-leavemsg)
exten = vm-u,n,Read(digito,,1,,,4)
exten = vm-u,n,GotoIf($[${digito}=5]?vm-s,1)
exten = vm-u,n,playback(/var/spool/asterisk/voicemail/default/${REALARG1}/unavail)
exten = vm-u,n,Playback(vm-leavemsg)
exten = vm-u,n,Read(digito,,1,,,3)
exten = vm-u,n,GotoIf($[${digito}=5]?vm-s,1)
exten = vm-u,n,Hangup()
exten = follow-me-busy,1,GotoIf(${DB(CFD/${REALARG1})}>0?vm-b,1)
exten = follow-me-busy,2,Set(cfnum=${DB(CF/${REALARG1})})
exten = follow-me-busy,3,GotoIf($[${LEN(${cfnum})}<1]?vm-b,1)
exten = follow-me-busy,4,GotoIf($["${cfnum}" = "${REALARG1}"]?vm-b,1)
exten = follow-me-busy,5,Set(IsFollowme=${IF($[${IsFromOutside} = 1]?1:0)})
exten = follow-me-busy,6,Followme(${REALARG1},n)
exten = follow-me-busy,7,Goto(vm-b,1)
exten = vm-b,1,GotoIf($[${PRESS5TOLEVMSG_ENABLE} = 1]?vm-b,2:vm-busy,1)
exten = vm-b,n,playback(/var/spool/asterisk/voicemail/default/${REALARG1}/busy)
exten = vm-b,n,Playback(vm-leavemsg)
exten = vm-b,n,Read(digito,,1,,,3)
exten = vm-b,n,GotoIf($[${digito}=5]?vm-s,1)
exten = vm-b,n,playback(/var/spool/asterisk/voicemail/default/${REALARG1}/busy)
exten = vm-b,n,Playback(vm-leavemsg)
exten = vm-b,n,Read(digito,,1,,,4)
exten = vm-b,n,GotoIf($[${digito}=5]?vm-s,1)
exten = vm-b,n,playback(/var/spool/asterisk/voicemail/default/${REALARG1}/busy)
exten = vm-b,n,Playback(vm-leavemsg)
exten = vm-b,n,Read(digito,,1,,,3)
exten = vm-b,n,GotoIf($[${digito}=5]?vm-s,1)
exten = vm-b,n,Hangup()
exten = vm-unavail,1,Voicemail(${REALARG1},u)
exten = vm-unavail,n,Hangup()
exten = vm-busy,1,Voicemail(${REALARG1},b)
exten = vm-busy,n,Hangup()
exten = vm-s,1,Voicemail(${REALARG1},s)
exten = vm-s,n,Hangup()
exten = in_userblack,1,GotoIf(${DB_EXISTS(${ARG1}/iblack-${GETNAMEBYCALLERID(${CALLERID(num)})})}?Unkown-Handle,s,1:s,6)
exten = in_userwhite,1,GotoIf( ${DB_EXISTS(${ARG1}/iwhite-${GETNAMEBYCALLERID(${CALLERID(num)})})}?s,6:Unkown-Handle,s,1)
exten = 1-out,1,Hangup()
[macro-trunkdial-failover-0.3]
exten = s,1,NOOP(do call out)
exten = s,2,GotoIf(${DB_EXISTS(${GETNAMEBYCALLERID(${CALLERID(num)})}/blackwhite)}?s,3:s,4)
exten = s,3,GotoIf( $[${DB_RESULT} = 1]?out_userwhite,1:out_userblack,1)
exten = s,4,GotoIf(${DB_EXISTS(oblacklist/${ARG3})}?Blacklist-Handle,s,1)
exten = s,5,Gotoif($[${LEN(${FromSystemAlert})}>0]?8:6)
exten = s,6,Gotoif($[${LEN(${ARG$[${ARG1}+4]})}>0]?7:8)
exten = s,7,Goto(s,6)
exten = s,8,Set(TCOUNT=4)
exten = s,n,Set(CDR(userfield)=Outbound)
exten = s,n,Set(OldCallerID=${IF($[${LEN(${PINUSER_CONTEXT})} > 0]?${PINUSER_CONTEXT:13}:${GETNAMEBYCALLERID(${CALLERID(num)})})})
exten = s,n,Set(TOUCH_MONITOR=${OldCallerID}-${ARG3})
exten = s,n,NOOP(${DOD_${ARG${TCOUNT}}_${OldCallerID}})
exten = s,n,Set(TIMEOUT(absolute)=${IF($[${LEN(${ABSOLUTE_TIMEOUT_${OldCallerID}})} > 0]?${ABSOLUTE_TIMEOUT_${OldCallerID}}:${ABSOLUTE_TIMEOUT})})
exten = s,n,Set(DLSTAT=UNKNOW})
exten = s,n,SetCktCustom(sendrpid,no,no)
exten = s,n,Gotoif(${ARG1}>0?1-dial,1)
exten = 1-dial,1,Gotoif($[$[${TCOUNT}-3]>${ARG1}]?nextrouter,1)
exten = 1-dial,2,Gotoif($[${LEN(${DOD_${ARG${TCOUNT}}_${OldCallerID}})} > 2]?setdod,1:1-dial,3)
exten = 1-dial,3,Set(CALLERID(name)=${IF($[${LEN(${CID_${ARG${TCOUNT}}})} > 2]?${CID_${ARG${TCOUNT}}}:${CALLERID(name)})})
exten = 1-dial,4,Set(CALLERID(num)=${IF($[${LEN(${CID_${ARG${TCOUNT}}})} > 2]?${CID_${ARG${TCOUNT}}}:${CALLERID(num)})})
exten = 1-dial,5,GotoIf($[${LEN(${${ARG${TCOUNT}}-enable})} = 2 ]?status-disable,1)
exten = 1-dial,6,Set(_SIPSRTP=${SIPPEER(${ARG${TCOUNT}},srtpcapable)})
exten = 1-dial,7,Set(OUTDIALOPT=${IF($[${LEN(${GSM_${ARG${TCOUNT}}})} > 0]?tTkKWwXxr:${DIALOPTIONS})})
exten = 1-dial,8,NOOP(null for std)
exten = 1-dial,9,Gotoif($[${LEN(${FromSystemAlert})}>0]?sys-dial,1)
exten = 1-dial,10,Dial(${${ARG${TCOUNT}}}/${ARG2}${PREFIX_${ARG${TCOUNT}}}${ARG3},,${OUTDIALOPT})
exten = 1-dial,n,Goto(1-${DIALSTATUS},1)
exten = sys-dial,1,Macro(sysdial,${${ARG${TCOUNT}}}/${ARG2}${PREFIX_${ARG${TCOUNT}}}${ARG3},,${OUTDIALOPT})
exten = setdod,1,Set(CALLERID(name)=${DOD_${ARG${TCOUNT}}_${OldCallerID}})
exten = setdod,2,Set(CALLERID(num)=${DOD_${ARG${TCOUNT}}_${OldCallerID}})
exten = setdod,3,Goto(1-dial,5)
exten = 1-BUSY,1,Set(DLSTAT=9-${DIALSTATUS})
exten = 1-BUSY,2,Goto(2-dial,1)
exten = 1-CHANUNAVAIL,1,Set(DLSTAT=9-${DIALSTATUS})
exten = 1-CHANUNAVAIL,2,Goto(2-dial,1))
exten = 1-CONGESTION,1,Set(DLSTAT=9-${DIALSTATUS})
exten = 1-CONGESTION,2,Goto(2-dial,1)
exten = 2-dial,1,Set(TCOUNT=$[${TCOUNT}+1])
exten = 2-dial,2,Goto(1-dial,1)
exten = 1-out,1,playback(all-busy-now-try-call-later,noanswer)
exten = 1-out,2,Hangup()
exten = 9-BUSY,1,playback(all-busy-now-try-call-later,noanswer)
exten = 9-BUSY,2,Hangup()
exten = 9-CHANUNAVAIL,1,playback(all-busy-now-try-call-later,noanswer)
exten = 9-CHANUNAVAIL,2,Hangup()
exten = 9-CONGESTION,1,playback(all-busy-now-try-call-later,noanswer)
exten = 9-CONGESTION,2,Hangup()
exten = nextrouter,1,GotoIf($[${LEN(${NEXTROUTER})} > 0]?${NEXTROUTER},${ORGINEXTEN},1:${DLSTAT},1)
exten = status-disable,1,Noop(please enable trunk!!!)
exten = h,1,NOOP(no thing to do)
exten = out_userblack,1,GotoIf(${DB_EXISTS(${GETNAMEBYCALLERID(${CALLERID(num)})}/oblack-${ARG3})}?Unknown-Handle,s,1:s,4)
exten = out_userwhite,1,GotoIf(${DB_EXISTS(${GETNAMEBYCALLERID(${CALLERID(num)})}/owhite-${ARG3})}?s,4:Unknown-Handle,s,1)
[macro-sysdial]
exten = s,1,Set(CALLERID(num)=Alarm)
exten = s,2,Set(CALLERID(name)=Alarm)
exten = s,3,Dial(${ARG1},${ARG2},${ARG3})
exten = s,4,Goto(sys-${DIALSTATUS},1)
exten = sys-ANSWER,1,Hangup()
[macro-trunkdial-failover-0.4]
exten = s,1,GotoIf($[${ARG1}==0]?h,1:s,2)
exten = s,2,GotoIf(${DB_EXISTS(${GETNAMEBYCALLERID(${CALLERID(num)})}/blackwhite)}?s,3:s,4)
exten = s,3,GotoIf( $[${DB_RESULT} = 1]?out_userwhite,1:out_userblack,1)
exten = s,4,GotoIf(${DB_EXISTS(oblacklist/${ARG3})}?Blacklist-Handle,s,1)
exten = s,5,Gotoif($[${LEN(${FromSystemAlert})}>0]?8:6)
exten = s,6,Gotoif($[${LEN(${ARG$[${ARG1}+4]})}>0]?7:8)
exten = s,7,Goto(s,6)
exten = s,8,Set(TCOUNT=4)
exten = s,n,Set(CDR(userfield)=Outbound)
exten = s,n,Set(OldCallerID=${IF($[${LEN(${PINUSER_CONTEXT})} > 0]?${PINUSER_CONTEXT:13}:${GETNAMEBYCALLERID(${CALLERID(num)})})})
exten = s,n,Set(TOUCH_MONITOR=${OldCallerID}-${ARG3})
exten = s,n,NOOP(${DOD_${ARG${TCOUNT}}_${OldCallerID}})
exten = s,n,Set(TIMEOUT(absolute)=${IF($[${LEN(${ABSOLUTE_TIMEOUT_${OldCallerID}})} > 0]?${ABSOLUTE_TIMEOUT_${OldCallerID}}:${ABSOLUTE_TIMEOUT})})
exten = s,n,Set(DLSTAT=UNKNOW})
exten = s,n,SetCktCustom(sendrpid,no,no)
exten = s,n,Gotoif(${ARG1}>0?1-dial,1)
exten = 1-dial,1,Gotoif($[$[${TCOUNT}-3]>${ARG1}]?nextrouter,1)
exten = 1-dial,2,Gotoif($["${IsTrunkInbound}" = "1"]?6:3)
exten = 1-dial,3,Gotoif($[${LEN(${DOD_${ARG${TCOUNT}}_${OldCallerID}})} > 2]?setdod,1:1-dial,4)
exten = 1-dial,4,Set(CALLERID(name)=${IF($[${LEN(${CID_${ARG${TCOUNT}}})} > 2]?${CID_${ARG${TCOUNT}}}:${CALLERID(name)})})
exten = 1-dial,5,Set(CALLERID(num)=${IF($[${LEN(${CID_${ARG${TCOUNT}}})} > 2]?${CID_${ARG${TCOUNT}}}:${CALLERID(num)})})
exten = 1-dial,6,GotoIf($[${${ARG${TCOUNT}}-enable}=0]?status-disable,1)
exten = 1-dial,7,Set(_SIPSRTP=${SIPPEER(${ARG${TCOUNT}},srtpcapable)})
exten = 1-dial,8,Set(OUTDIALOPT=${IF($[${LEN(${GSM_${ARG${TCOUNT}}})} > 0]?tTkKWwXxr:${DIALOPTIONS})})
exten = 1-dial,9,NOOP(null for std)
exten = 1-dial,10,Gotoif($[${LEN(${FromSystemAlert})}>0]?sys-dial,1)
exten = 1-dial,11,Dial(${${ARG${TCOUNT}}}/${ARG2}${PREFIX_${ARG${TCOUNT}}}${ARG3},,${OUTDIALOPT})
exten = 1-dial,n,Goto(1-${DIALSTATUS},1)
exten = sys-dial,1,Macro(sysdial,${${ARG${TCOUNT}}}/${ARG2}${PREFIX_${ARG${TCOUNT}}}${ARG3},,${OUTDIALOPT})
exten = setdod,1,Set(CALLERID(name)=${DOD_${ARG${TCOUNT}}_${OldCallerID}})
exten = setdod,2,Set(CALLERID(num)=${DOD_${ARG${TCOUNT}}_${OldCallerID}})
exten = setdod,3,Goto(1-dial,6)
exten = 1-BUSY,1,Set(DLSTAT=9-${DIALSTATUS})
exten = 1-BUSY,2,Goto(2-dial,1)
exten = 1-CHANUNAVAIL,1,Set(DLSTAT=9-${DIALSTATUS})
exten = 1-CHANUNAVAIL,2,Goto(2-dial,1))
exten = 1-CONGESTION,1,Set(DLSTAT=9-${DIALSTATUS})
exten = 1-CONGESTION,2,Goto(2-dial,1)
exten = 2-dial,1,Set(TCOUNT=$[${TCOUNT}+1])
exten = 2-dial,2,Goto(1-dial,1)
exten = nextrouter,1,GotoIf($[${LEN(${NEXTROUTER})} > 0]?${NEXTROUTER},${ORGINEXTEN},1)
exten = status-disable,1,Noop(please enable trunk!!!)
exten = h,1,NOOP(no thing to do)
exten = out_userblack,1,GotoIf(${DB_EXISTS(${GETNAMEBYCALLERID(${CALLERID(num)})}/oblack-${ARG3})}?Unknown-Handle,s,1:s,4)
exten = out_userwhite,1,GotoIf(${DB_EXISTS(${GETNAMEBYCALLERID(${CALLERID(num)})}/owhite-${ARG3})}?s,4:Unknown-Handle,s,1)
[macro-pagingintercom]
exten = s,1,SIPAddHeader(Alert-Info:Ring Answer)
exten = s,n,SIPAddHeader(Call-Info:<uri>\;answer-after=0)
exten = s,n,Page(${ARG1},${ARG2})
exten = s,n,Hangup
[Always-Hangup]
exten = s,1,Hangup
[Blacklist-Handle]
exten = s,1,Answer()
exten = s,n,wait(1)
exten = s,n,playback(ss-noservice)
exten = s,n,Hangup()
[chanspy-invalid]
exten = s,1,Hangup
[voicemailgroups]
[directory]
[pri_income]
[macro-trunkdial-t38fax]
exten = s,1,Wait(1)
exten = s,2,Gotoif($[${LEN(${FromSystemAlert})}>0]?5:3)
exten = s,3,Gotoif($[${LEN(${ARG$[${ARG1}+4]})}>0]?4:5)
exten = s,4,Authenticate(${ARG$[${ARG1}+4]})
exten = s,5,Set(TCOUNT=4)
exten = s,n,Set(CDR(userfield)=Outbound)
exten = s,n,Set(TOUCH_MONITOR=${CALLERID(num)}-${ARG3})
exten = s,n,noop(${DOD_${ARG${TCOUNT}}_${CALLERID(num)}})
exten = s,n,Gotoif($[${LEN(${FromSystemAlert})}>0]?sys-dial,1)
exten = s,n,Gotoif(${ARG1}>0?1-dial,1)
exten = 1-dial,1,Gotoif($[$[${TCOUNT}-3]>${ARG1}]?1-out,1)
exten = 1-dial,2,Gotoif($[${LEN(${DOD_${ARG${TCOUNT}}_${CALLERID(num)}})} > 2]?setdod,1:1-dial,3)
exten = 1-dial,3,Set(CALLERID(num)=${IF($[${LEN(${CID_${ARG${TCOUNT}}})} > 2]?${CID_${ARG${TCOUNT}}}:${CALLERID(num)})})
exten = 1-dial,4,Dial(${${ARG${TCOUNT}}}/${ARG2}${PREFIX_${ARG${TCOUNT}}}${ARG3},,tTkKWwXxb)
exten = 1-dial,5,Goto(1-${DIALSTATUS},1)
exten = sys-dial,1,Macro(sysdial,${${ARG${TCOUNT}}}/${ARG2}${PREFIX_${ARG${TCOUNT}}}${ARG3},,${OUTDIALOPT})
exten = setdod,1,Set(CALLERID(name)=${DOD_${ARG${TCOUNT}}_${CALLERID(num)}})
exten = setdod,2,Set(CALLERID(num)=${DOD_${ARG${TCOUNT}}_${CALLERID(num)}})
exten = setdod,3,Goto(1-dial,4)
exten = 1-BUSY,1,Goto(2-dial,1)
exten = 1-CHANUNAVAIL,1,Goto(2-dial,1))
exten = 1-CONGESTION,1,Goto(2-dial,1)
exten = 2-dial,1,Set(TCOUNT=$[${TCOUNT}+1])
exten = 2-dial,2,Goto(1-dial,1)
exten = 1-out,1,playback(all-busy-now-try-call-later)
exten = 1-out,2,Hangup()
exten = h,1,NOOP(no thing to do)
[asterisk_guitools]
exten = executecommand,1,System(${command})
exten = executecommand,n,Hangup()
exten = record_vmenu,1,Set(CHANNEL(language)=ru)
exten = record_vmenu,n,Answer
exten = record_vmenu,n,Playback(vm-intro)
exten = record_vmenu,n,Record(${var1},,,kS)
exten = record_vmenu,n,Set(CHANNEL(language)=ru)
exten = record_vmenu,n,Playback(vm-saved)
exten = record_vmenu,n,Playback(vm-goodbye)
exten = record_vmenu,n,Hangup
exten = play_file,1,Answer
exten = play_file,n,Playback(${var1})
exten = play_file,n,Hangup
[default]
exten = .,1,Goto(${EXTEN})
exten = _#.,1,VoiceMail(${EXTEN:1}@default,u)
exten = _#.,2,hangup
exten = h,1,NOOP(no thing to do)
exten = h,2,Hangup()
exten = *2,1,VoiceMailMain(${CONTEXT:13}@default)
[pickup_specific_extension]
exten = _*04.,1,Set(lockresult=${LOCK(YEASTARCKTMUTEX)})
exten = _*04.,2,GotoIf($[${lockresult}=1]?7)
exten = _*04.,3,WAIT(2)
exten = _*04.,4,Set(lockresult=${LOCK(YEASTARCKTMUTEX)})
exten = _*04.,5,GotoIf($[${lockresult}=0]?6:7)
exten = _*04.,6,Hangup
exten = _*04.,7,Pickup(${EXTEN:3}@PICKUPMARK)
exten = _*04.,8,Set(unlockresult=${UNLOCK(YEASTARCKTMUTEX)})
[page_an_extension]
exten = _*5.,1,Macro(pagingintercom,SIP/${EXTEN:2},d)
[set-cf-default]
exten = *70,1,Answer
exten = *70,n,Set(DB(CFD/${CONTEXT:13})=1)
exten = *70,n,Set(DB(CFB/${CONTEXT:13})=1)
exten = *70,n,Set(DB(CFN/${CONTEXT:13})=1)
exten = *70,n,Set(DB(CFA/${CONTEXT:13})=0)
exten = *70,n,Set(DB(DND/${CONTEXT:13})=0)
exten = *70,n,Wait(1)
exten = *70,n,Playback(beep)
exten = *70,n,Wait(1)
exten = *70,n,Hangup()
[en-always-cf]
exten = *71,1,Answer
exten = *71,n,Set(DB(CFA/${CONTEXT:13})=1)
exten = *71,n,Wait(1)
exten = *71,n,Playback(beep)
exten = *71,n,Wait(1)
exten = *71,n,Hangup()
[dis-always-cf]
exten = *071,1,Answer
exten = *071,n,Set(DB(CFA/${CONTEXT:13})=0)
exten = *071,n,Wait(1)
exten = *071,n,Playback(beep)
exten = *071,n,Wait(1)
exten = *071,n,Hangup()
[en-busy-cf]
exten = *72,1,Answer
exten = *72,n,Set(DB(CFB/${CONTEXT:13})=1)
exten = *72,n,Wait(1)
exten = *72,n,Playback(beep)
exten = *72,n,Wait(1)
exten = *72,n,Hangup()
[dis-busy-cf]
exten = *072,1,Answer
exten = *072,n,Set(DB(CFB/${CONTEXT:13})=0)
exten = *072,n,Wait(1)
exten = *072,n,Playback(beep)
exten = *072,n,Wait(1)
exten = *072,n,Hangup()
[en-noanswer-cf]
exten = *73,1,Answer
exten = *73,n,Set(DB(CFN/${CONTEXT:13})=1)
exten = *73,n,Wait(1)
exten = *73,n,Playback(beep)
exten = *73,n,Wait(1)
exten = *73,n,Hangup()
[dis-noanswer-cf]
exten = *073,1,Answer
exten = *073,n,Set(DB(CFN/${CONTEXT:13})=0)
exten = *073,n,Wait(1)
exten = *073,n,Playback(beep)
exten = *073,n,Wait(1)
exten = *073,n,Hangup()
[set-cf-number]
exten = *74,1,Answer
exten = *74,n,Set(DB(CFD/${CONTEXT:13})=0)
exten = *74,n,Wait(1)
exten = *74,n,Playback(beep)
exten = *74,n,Wait(1)
exten = *74,n,Hangup()
exten = _*74.,1,Answer
exten = _*74.,n,Set(DB(CFD/${CONTEXT:13})=0)
exten = _*74.,n,Set(DB(CF/${CONTEXT:13})=${EXTEN:3})
exten = _*74.,n,Wait(1)
exten = _*74.,n,Playback(beep)
exten = _*74.,n,Wait(1)
exten = _*74.,n,Hangup()
[set-cf-vm]
exten = *074,1,Answer
exten = *074,n,Set(DB(CFD/${CONTEXT:13})=1)
exten = *074,n,Wait(1)
exten = *074,n,Playback(beep)
exten = *074,n,Wait(1)
exten = *074,n,Hangup()
[en-dnd]
exten = *75,1,Answer
exten = *75,n,Set(DB(DND/${CONTEXT:13})=1)
exten = *75,n,Wait(1)
exten = *75,n,Playback(beep)
exten = *75,n,Wait(1)
exten = *75,n,Hangup()
[dis-dnd]
exten = *075,1,Answer
exten = *075,n,Set(DB(DND/${CONTEXT:13})=0)
exten = *075,n,Wait(1)
exten = *075,n,Playback(beep)
exten = *075,n,Wait(1)
exten = *075,n,Hangup()
[vmm]
exten = *02,1,VoiceMailMain()
[chan-spy-normal]
exten = _*90X.,1,Noop(going to spy)
 same = n,Set(PRILEN=${LEN(*90)})
 same = n,GotoIf(${DB_EXISTS(allowspy/${EXTEN:${PRILEN}})}?:chanspy-invalid,s,1)
 same = n,GotoIf(${LEN(${DIALPARAM_OF_EXTEN${EXTEN:${PRILEN}}})}?:chanspy-invali,s,1)
 same = n,Answer
 same = n,Wait(1)
 same = n,ChanSpy(${DIALPARAM_OF_EXTEN${EXTEN:${PRILEN}}},q)
 same = n,Hangup
[chan-spy-whisper]
exten = _*91X.,1,Noop(going to spy)
 same = n,Set(PRILEN=${LEN(*91)})
 same = n,GotoIf(${DB_EXISTS(allowspy/${EXTEN:${PRILEN}})}?:chanspy-invalid,s,1)
 same = n,GotoIf(${LEN(${DIALPARAM_OF_EXTEN${EXTEN:${PRILEN}}})}?:chanspy-invali,s,1)
 same = n,Answer
 same = n,Wait(1)
 same = n,ChanSpy(${DIALPARAM_OF_EXTEN${EXTEN:${PRILEN}}},wq)
 same = n,Hangup
[chan-spy-barge]
exten = _*92X.,1,Noop(going to spy)
 same = n,Set(PRILEN=${LEN(*92)})
 same = n,GotoIf(${DB_EXISTS(allowspy/${EXTEN:${PRILEN}})}?:chanspy-invalid,s,1)
 same = n,GotoIf(${LEN(${DIALPARAM_OF_EXTEN${EXTEN:${PRILEN}}})}?:chanspy-invali,s,1)
 same = n,Answer
 same = n,Wait(1)
 same = n,ChanSpy(${DIALPARAM_OF_EXTEN${EXTEN:${PRILEN}}},Bq)
 same = n,Hangup

[voicemenu-custom-welcome]
exten = 660,1,NoOp(welcome)
exten = 660,n,Set(CDR(orgdst)=660-ivr)
exten = 660,n,Background(record/default)
exten = 660,n,WaitExten(3)
exten = 660,n,Background(record/default)
exten = 660,n,WaitExten(3)
exten = 660,n,Background(record/default)
exten = 660,n,WaitExten(3)
exten = 0,1,Goto(from-outside,100,1)
exten = t,1,Goto(from-outside,100,1)
exten = i,1,Goto(from-outside,100,1)
include = from-outside
include = conferences
include = vmm
[voicemenu-custom-661]
exten = 661,1,NoOp(661)
exten = 661,n,Set(CDR(orgdst)=661-ivr)
exten = 661,n,Background(record/default)
exten = 661,n,WaitExten(3)
exten = 661,n,Background(record/default)
exten = 661,n,WaitExten(3)
exten = 661,n,Background(record/default)
exten = 661,n,WaitExten(3)
exten = t,1,NoOp(do..)
exten = i,1,NoOp(do..)
[voicemenu-custom-662]
exten = 662,1,NoOp(662)
exten = 662,n,Set(CDR(orgdst)=662-ivr)
exten = 662,n,Background(record/default)
exten = 662,n,WaitExten(3)
exten = 662,n,Background(record/default)
exten = 662,n,WaitExten(3)
exten = 662,n,Background(record/default)
exten = 662,n,WaitExten(3)
exten = t,1,NoOp(do..)
exten = i,1,NoOp(do..)
include = from-outside
include = conferences
include = vmm
[voicemenus]
exten = 660,1,Goto(voicemenu-custom-welcome,660,1)
exten = 661,1,Goto(voicemenu-custom-661,661,1)
exten = 662,1,Goto(voicemenu-custom-662,662,1)

[ringroups-custom-ringgroup_default]
exten = 620,1,Wait(1)
exten = 620,n,Dial(SIP/104,60,TtKkXxc)
exten = 620,n,Goto(from-outside,100,1)
[ringroups-custom-621]
exten = 621,1,Wait(1)
exten = 621,n,Dial(SIP/100&SIP/101&SIP/102,60,TtKkXxc)
exten = 621,n,NoOp(do..)
[ringgroups]
exten = 620,1,Goto(ringroups-custom-ringgroup_default,620,1)
exten = 621,1,Goto(ringroups-custom-621,621,1)


[conferences]
exten = 640,1,Set(MEETMEOPT=${IF($[${EXISTS(${CONF_640_ADMIN_${CALLERID(num)}})}]?${MEETMEEXTENOPT}Msa:${MEETMEEXTENOPT}Ms)})
exten = 640,2,MeetMe(${EXTEN},${MEETMEOPT})
exten = 640,3,Hangup()
exten = 641,1,Set(MEETMEOPT=${IF($[${EXISTS(${CONF_641_ADMIN_${CALLERID(num)}})}]?${MEETMEEXTENOPT}Msa:${MEETMEEXTENOPT}Ms)})
exten = 641,2,MeetMe(${EXTEN},${MEETMEOPT})
exten = 641,3,Hangup()
exten = 642,1,Set(MEETMEOPT=${IF($[${EXISTS(${CONF_642_ADMIN_${CALLERID(num)}})}]?${MEETMEEXTENOPT}Msa:${MEETMEEXTENOPT}Ms)})
exten = 642,2,MeetMe(${EXTEN},${MEETMEOPT})
exten = 642,3,Hangup()
exten = 643,1,Set(MEETMEOPT=${IF($[${EXISTS(${CONF_643_ADMIN_${CALLERID(num)}})}]?${MEETMEEXTENOPT}Msa:${MEETMEEXTENOPT}Ms)})
exten = 643,2,MeetMe(${EXTEN},${MEETMEOPT})
exten = 643,3,Hangup()
exten = 644,1,Set(MEETMEOPT=${IF($[${EXISTS(${CONF_644_ADMIN_${CALLERID(num)}})}]?${MEETMEEXTENOPT}Msa:${MEETMEEXTENOPT}Ms)})
exten = 644,2,MeetMe(${EXTEN},${MEETMEOPT})
exten = 644,3,Hangup()
exten = 645,1,Set(MEETMEOPT=${IF($[${EXISTS(${CONF_645_ADMIN_${CALLERID(num)}})}]?${MEETMEEXTENOPT}Msa:${MEETMEEXTENOPT}Ms)})
exten = 645,2,MeetMe(${EXTEN},${MEETMEOPT})
exten = 645,3,Hangup()

[pagegroups]
exten = 630,1,Macro(pagingintercom,SIP/202,d)

[CallingRule_ViaFXO]
exten = _89034.,1,Set(agiresult=0)
exten = _89034.,n,GotoIf($[${agiresult}=1]?play-no-balance,${EXTEN},1)
exten = _89034.,n,GotoIf($[${agiresult}=2]?play-ext-disabled,${EXTEN},1)
exten = _89034.,n,GotoIf($[${agiresult}=4]?ext-no-rate,${EXTEN},1)
exten = _89034.,n,noop(no pinset)
exten = _89034.,n(a8),Set(ORGINEXTEN=${EXTEN})
exten = _89034.,n,Set(ORGINCONTEXT=${IF($[${LEN(${ORGINCONTEXT})} > 0]?${ORGINCONTEXT}: ${CONTEXT})})
exten = _89034.,n,GetNextOutRouter(${ORGINCONTEXT},)
exten = _89034.,n,GotoByTimeConditionOutbound(,0)
exten = _89034.,n,Macro(trunkdial-failover-0.3,1,,${EXTEN:5},trunk_76)
[Mobile_CallingRule_ViaFXO]
exten = _89034.,1,Set(agiresult=0)
exten = _89034.,n,GotoIf($[${agiresult}=1]?play-no-balance,${EXTEN},1)
exten = _89034.,n,GotoIf($[${agiresult}=2]?play-ext-disabled,${EXTEN},1)
exten = _89034.,n,GotoIf($[${agiresult}=4]?ext-no-rate,${EXTEN},1)
exten = _89034.,n,noop(no pinset)
exten = _89034.,n(a8),Set(ORGINEXTEN=${EXTEN})
exten = _89034.,n,Set(ORGINCONTEXT=${IF($[${LEN(${ORGINCONTEXT})} > 0]?${ORGINCONTEXT}: ${CONTEXT})})
exten = _89034.,n,GetNextOutRouter(${ORGINCONTEXT},)
exten = _89034.,n,GotoByTimeConditionOutbound(,0)
exten = _89034.,n,Macro(trunkdial-failover-0.4,0,,${EXTEN:5},)

[DLPN_SystemAlert]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
[DLPN_DialPlan100]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_100
[Mobile_DLPN_DialPlan100]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan101]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_101
[Mobile_DLPN_DialPlan101]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan102]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_102
[Mobile_DLPN_DialPlan102]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan103]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_103
[Mobile_DLPN_DialPlan103]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan104]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_104
[Mobile_DLPN_DialPlan104]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan105]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_105
[Mobile_DLPN_DialPlan105]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan106]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_106
[Mobile_DLPN_DialPlan106]
[DLPN_DialPlan107]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_107
[Mobile_DLPN_DialPlan107]
[DLPN_DialPlan108]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_108
[Mobile_DLPN_DialPlan108]
[DLPN_DialPlan109]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_109
[Mobile_DLPN_DialPlan109]
[DLPN_DialPlan110]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_110
[Mobile_DLPN_DialPlan110]
[DLPN_DialPlan200]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_200
[Mobile_DLPN_DialPlan200]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan201]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_201
[Mobile_DLPN_DialPlan201]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan202]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_202
[Mobile_DLPN_DialPlan202]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan203]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_203
[Mobile_DLPN_DialPlan203]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan204]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_204
[Mobile_DLPN_DialPlan204]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan205]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_205
[Mobile_DLPN_DialPlan205]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan206]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_206
[Mobile_DLPN_DialPlan206]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan207]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_207
[Mobile_DLPN_DialPlan207]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan208]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_208
[Mobile_DLPN_DialPlan208]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan209]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_209
[Mobile_DLPN_DialPlan209]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan210]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_210
[Mobile_DLPN_DialPlan210]
[DLPN_DialPlan211]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_211
[Mobile_DLPN_DialPlan211]
[DLPN_DialPlan212]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_212
[Mobile_DLPN_DialPlan212]
[DLPN_DialPlan213]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_213
[Mobile_DLPN_DialPlan213]
[DLPN_DialPlan214]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_214
[Mobile_DLPN_DialPlan214]
[DLPN_DialPlan215]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_215
[Mobile_DLPN_DialPlan215]
[DLPN_DialPlan216]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_216
[Mobile_DLPN_DialPlan216]
[DLPN_DialPlan217]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_217
[Mobile_DLPN_DialPlan217]
[DLPN_DialPlan218]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_218
[Mobile_DLPN_DialPlan218]
[DLPN_DialPlan219]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_219
[Mobile_DLPN_DialPlan219]
[DLPN_DialPlan220]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_220
[Mobile_DLPN_DialPlan220]
[DLPN_DialPlan221]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_221
[Mobile_DLPN_DialPlan221]
[DLPN_DialPlan222]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_222
[Mobile_DLPN_DialPlan222]
[DLPN_DialPlan223]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_223
[Mobile_DLPN_DialPlan223]
[DLPN_DialPlan224]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_224
[Mobile_DLPN_DialPlan224]
[DLPN_DialPlan256]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_256
[Mobile_DLPN_DialPlan256]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan257]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_257
[Mobile_DLPN_DialPlan257]
[DLPN_DialPlan258]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_258
[Mobile_DLPN_DialPlan258]
[DLPN_DialPlan259]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_259
[Mobile_DLPN_DialPlan259]
[DLPN_DialPlan602]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_602
[Mobile_DLPN_DialPlan602]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan603]
include = Local_Default_CallingRules
include = CallingRule_ViaFXO
include = PhysicalDial_CallingRule_603
[Mobile_DLPN_DialPlan603]
include = Mobile_CallingRule_ViaFXO
[DLPN_DialPlan604]
include = Local_Default_CallingRules
include = PhysicalDial_CallingRule_604
[Mobile_DLPN_DialPlan604]

[macro-checkcallback]
exten = s,1,GotoIf(${LEN(${CALLERID(num)})}?s,2:s-nocb,1)
exten = s,2,Goto(${CALLERID(num)},1)
exten = s,3,Hangup()
exten = s-nocb,1,GotoIf(${LEN(${ARG5})}?2:6)
exten = s-nocb,2,GotoIf(${LEN(${ARG9})}?3:4)
exten = s-nocb,3,SIPAddHeader(Alert-Info: <http://192.168.254.32>\;info=${ARG10})
exten = s-nocb,4,Macro(timecondition,${ARG4},${ARG5},${ARG6},${ARG7},${ARG8},${ARG9})
exten = s-nocb,5,Hangup()
exten = s-nocb,6,Goto(from-outside,${ARG4},1)
exten = s-fxocallback,1,Macro(callback_fxo_${ARG1},${ARG3},${ARG4})
exten = s-normalcallback,1,Macro(callback_${ARG1},${ARG3},${ARG4})
exten = _X.,1,Goto(s-nocb,1)
exten = _+.,1,Goto(s-nocb,1)
[macro-incoming_pstnin]
exten = s,1,Set(CDR(userfield)=Inbound)
exten = s,n,GotoIf(${DB_EXISTS(blacklist/${CALLERID(num)})}?Blacklist-Handle,s,1)
exten = s,n,FindForMobile(${CALLERID(num)})
exten = s,n,GotoIf($[${LEN(${MobileToExten})}>1]?mobile-exten-match,${MobileToExten},1)
exten = s,n,Set(TRUNKDID=${IF($[${ARG2}=s]?${CALLERID(name)}:${ARG2})})
exten = s,n,GotoByTimeCondition(default,voicemenu-custom-welcome,660,1,,voicemenu-custom-welcome,660,1,,Always-Hangup,s,1,)
exten = s,102,Goto(Blacklist-Handle,s,1)
[macro-incoming_from_400_2002_to_IVR661]
exten = s,1,Set(CDR(userfield)=Inbound)
exten = s,n,GotoIf(${DB_EXISTS(blacklist/${CALLERID(num)})}?Blacklist-Handle,s,1)
exten = s,n,FindForMobile(${CALLERID(num)})
exten = s,n,GotoIf($[${LEN(${MobileToExten})}>1]?mobile-exten-match,${MobileToExten},1)
exten = s,n,Set(TRUNKDID=${IF($[${ARG2}=s]?${CALLERID(name)}:${ARG2})})
exten = s,n,GotoByTimeCondition(default,voicemenu-custom-661,661,1,,voicemenu-custom-661,661,1,,voicemenu-custom-661,661,1,)
exten = s,102,Goto(Blacklist-Handle,s,1)
[macro-incoming_ir_from_TG400_20001_20002]
exten = s,1,Set(CDR(userfield)=Inbound)
exten = s,n,GotoIf(${DB_EXISTS(blacklist/${CALLERID(num)})}?Blacklist-Handle,s,1)
exten = s,n,FindForMobile(${CALLERID(num)})
exten = s,n,GotoIf($[${LEN(${MobileToExten})}>1]?mobile-exten-match,${MobileToExten},1)
exten = s,n,Set(TRUNKDID=${IF($[${ARG2}=s]?${CALLERID(name)}:${ARG2})})
exten = s,n,GotoByTimeCondition(default,voicemenu-custom-661,661,1,,voicemenu-custom-661,661,1,,voicemenu-custom-661,661,1,)
exten = s,102,Goto(Blacklist-Handle,s,1)

[DID_trunk_E1Trunk1]
exten = h,1,hangup()
[DID_trunk_E1Trunk2]
exten = h,1,hangup()
[from-trunk]
exten = 20002,1,Set(ENABLEDNIS=0)
exten = 20002,n,Set(IP_FROM_TRUNK=SIP/trunk-TG400_20002-)
exten = 20002,n,Macro(incoming_from_400_2002_to_IVR661,0,${EXTEN})
exten = 20002,1,Set(ENABLEDNIS=0)
exten = 20002,n,Set(IP_FROM_TRUNK=SIP/trunk-TG400_20002-)
exten = 20002,n,Macro(incoming_ir_from_TG400_20001_20002,0,${EXTEN})
exten = 20001,1,Set(ENABLEDNIS=0)
exten = 20001,n,Set(IP_FROM_TRUNK=SIP/trunk-TG400_20001-)
exten = 20001,n,Macro(incoming_ir_from_TG400_20001_20002,0,${EXTEN})
[from-trunk-TG400_20002]
exten = _.,1,Set(ENABLEDNIS=0)
exten = _.,n,Set(IP_FROM_TRUNK=SIP/trunk-TG400_20002-)
exten = _.,n,Macro(incoming_from_400_2002_to_IVR661,0,${EXTEN})
exten = _.,1,Set(ENABLEDNIS=0)
exten = _.,n,Set(IP_FROM_TRUNK=SIP/trunk-TG400_20002-)
exten = _.,n,Macro(incoming_ir_from_TG400_20001_20002,0,${EXTEN})
[from-trunk-TG400_20001]
exten = _.,1,Set(ENABLEDNIS=0)
exten = _.,n,Set(IP_FROM_TRUNK=SIP/trunk-TG400_20001-)
exten = _.,n,Macro(incoming_ir_from_TG400_20001_20002,0,${EXTEN})
[from-trunk-test]
[from-outside]
exten = 100,1,Macro(stdexten-fromoutside,100,${DIALPARAM_OF_EXTEN100})
exten = 100,2,Voicemail(100,u)
exten = 101,1,Macro(stdexten-fromoutside,101,${DIALPARAM_OF_EXTEN101})
exten = 101,2,Voicemail(101,u)
exten = 102,1,Macro(stdexten-fromoutside,102,${DIALPARAM_OF_EXTEN102})
exten = 102,2,Voicemail(102,u)
exten = 103,1,Macro(stdexten-fromoutside,103,${DIALPARAM_OF_EXTEN103})
exten = 103,2,Voicemail(103,u)
exten = 104,1,Macro(stdexten-fromoutside,104,${DIALPARAM_OF_EXTEN104})
exten = 104,2,Voicemail(104,u)
exten = 105,1,Macro(stdexten-fromoutside,105,${DIALPARAM_OF_EXTEN105})
exten = 105,2,Voicemail(105,u)
exten = 106,1,Macro(stdexten-fromoutside,106,${DIALPARAM_OF_EXTEN106})
exten = 106,2,Voicemail(106,u)
exten = 107,1,Macro(stdexten-fromoutside,107,${DIALPARAM_OF_EXTEN107})
exten = 107,2,Voicemail(107,u)
exten = 108,1,Macro(stdexten-fromoutside,108,${DIALPARAM_OF_EXTEN108})
exten = 108,2,Voicemail(108,u)
exten = 109,1,Macro(stdexten-fromoutside,109,${DIALPARAM_OF_EXTEN109})
exten = 109,2,Voicemail(109,u)
exten = 110,1,Macro(stdexten-fromoutside,110,${DIALPARAM_OF_EXTEN110})
exten = 110,2,Voicemail(110,u)
exten = 200,1,Macro(stdexten-fromoutside,200,${DIALPARAM_OF_EXTEN200})
exten = 200,2,Voicemail(200,u)
exten = 201,1,Macro(stdexten-fromoutside,201,${DIALPARAM_OF_EXTEN201})
exten = 201,2,Voicemail(201,u)
exten = 202,1,Macro(stdexten-fromoutside,202,${DIALPARAM_OF_EXTEN202})
exten = 202,2,Voicemail(202,u)
exten = 203,1,Macro(stdexten-fromoutside,203,${DIALPARAM_OF_EXTEN203})
exten = 203,2,Voicemail(203,u)
exten = 204,1,Macro(stdexten-fromoutside,204,${DIALPARAM_OF_EXTEN204})
exten = 204,2,Voicemail(204,u)
exten = 205,1,Macro(stdexten-fromoutside,205,${DIALPARAM_OF_EXTEN205})
exten = 205,2,Voicemail(205,u)
exten = 206,1,Macro(stdexten-fromoutside,206,${DIALPARAM_OF_EXTEN206})
exten = 206,2,Voicemail(206,u)
exten = 207,1,Macro(stdexten-fromoutside,207,${DIALPARAM_OF_EXTEN207})
exten = 207,2,Voicemail(207,u)
exten = 208,1,Macro(stdexten-fromoutside,208,${DIALPARAM_OF_EXTEN208})
exten = 208,2,Voicemail(208,u)
exten = 209,1,Macro(stdexten-fromoutside,209,${DIALPARAM_OF_EXTEN209})
exten = 209,2,Voicemail(209,u)
exten = 210,1,Macro(stdexten-fromoutside,210,${DIALPARAM_OF_EXTEN210})
exten = 210,2,Voicemail(210,u)
exten = 211,1,Macro(stdexten-fromoutside,211,${DIALPARAM_OF_EXTEN211})
exten = 211,2,Voicemail(211,u)
exten = 212,1,Macro(stdexten-fromoutside,212,${DIALPARAM_OF_EXTEN212})
exten = 212,2,Voicemail(212,u)
exten = 213,1,Macro(stdexten-fromoutside,213,${DIALPARAM_OF_EXTEN213})
exten = 213,2,Voicemail(213,u)
exten = 214,1,Macro(stdexten-fromoutside,214,${DIALPARAM_OF_EXTEN214})
exten = 214,2,Voicemail(214,u)
exten = 215,1,Macro(stdexten-fromoutside,215,${DIALPARAM_OF_EXTEN215})
exten = 215,2,Voicemail(215,u)
exten = 216,1,Macro(stdexten-fromoutside,216,${DIALPARAM_OF_EXTEN216})
exten = 216,2,Voicemail(216,u)
exten = 217,1,Macro(stdexten-fromoutside,217,${DIALPARAM_OF_EXTEN217})
exten = 217,2,Voicemail(217,u)
exten = 218,1,Macro(stdexten-fromoutside,218,${DIALPARAM_OF_EXTEN218})
exten = 218,2,Voicemail(218,u)
exten = 219,1,Macro(stdexten-fromoutside,219,${DIALPARAM_OF_EXTEN219})
exten = 219,2,Voicemail(219,u)
exten = 220,1,Macro(stdexten-fromoutside,220,${DIALPARAM_OF_EXTEN220})
exten = 220,2,Voicemail(220,u)
exten = 221,1,Macro(stdexten-fromoutside,221,${DIALPARAM_OF_EXTEN221})
exten = 221,2,Voicemail(221,u)
exten = 222,1,Macro(stdexten-fromoutside,222,${DIALPARAM_OF_EXTEN222})
exten = 222,2,Voicemail(222,u)
exten = 223,1,Macro(stdexten-fromoutside,223,${DIALPARAM_OF_EXTEN223})
exten = 223,2,Voicemail(223,u)
exten = 224,1,Macro(stdexten-fromoutside,224,${DIALPARAM_OF_EXTEN224})
exten = 224,2,Voicemail(224,u)
exten = 256,1,Macro(stdexten-fromoutside,256,${DIALPARAM_OF_EXTEN256})
exten = 256,2,Voicemail(256,u)
exten = 257,1,Macro(stdexten-fromoutside,257,${DIALPARAM_OF_EXTEN257})
exten = 257,2,Voicemail(257,u)
exten = 258,1,Macro(stdexten-fromoutside,258,${DIALPARAM_OF_EXTEN258})
exten = 258,2,Voicemail(258,u)
exten = 259,1,Macro(stdexten-fromoutside,259,${DIALPARAM_OF_EXTEN259})
exten = 259,2,Voicemail(259,u)
exten = 602,1,Macro(stdexten-fromoutside,602,${DIALPARAM_OF_EXTEN602})
exten = 602,2,Voicemail(602,u)
exten = 603,1,Macro(stdexten-fromoutside,603,${DIALPARAM_OF_EXTEN603})
exten = 603,2,Voicemail(603,u)
exten = 604,1,Macro(stdexten-fromoutside,604,${DIALPARAM_OF_EXTEN604})
exten = 604,2,Voicemail(604,u)

;param1-queue name, param2-queue pass, param3-exten name
[macro-queue-login]
exten = s,1,Wait(1)
exten = s,n,GotoIf(${ARG2}?3:4)
exten = s,n,Authenticate(${ARG2})
exten = s,n,AddQueueMember(${ARG1},,,,${ARG3})
exten = s,n,Playback(agent-loginok)
exten = s,n,Playback(vm-goodbye)
exten = s,n,Hangup()
;param1-queue name
[macro-queue-logout]
exten = s,1,Wait(1)
exten = s,n,RemoveQueueMember(${ARG1})
exten = s,n,Playback(agent-loggedoff)
exten = s,n,Playback(vm-goodbye)
exten = s,n,Hangup()
[queue-680]
exten = 680,1,Answer()
exten = 680,n,NoOp(no set join announce)
exten = 680,n,Queue(queue-680,tTkKXx,,,)
exten = 680,n,Goto(queue-,,1)

[queue-681]
exten = 681,1,Answer()
exten = 681,n,NoOp(no set join announce)
exten = 681,n,Queue(queue-681,tTkKXx,,,1800)
exten = 681,n,Hangup

[queues]
exten = 680,1,Goto(queue-680,680,1)
exten = 680*,1,Macro(queue-login,queue-680,,${CONTEXT:13})
exten = 680**,1,Macro(queue-logout,queue-680,${CONTEXT:13})
exten = 681,1,Goto(queue-681,681,1)
exten = 681*,1,Macro(queue-login,queue-681,,${CONTEXT:13})
exten = 681**,1,Macro(queue-logout,queue-681,${CONTEXT:13})


[t38-recvfax]
exten = _X.,1,Answer()
exten = _X.,n,Wait(3)
exten = _X.,n,Set(SENDMAIL=0)
exten = _X.,n,Set(MAILOWNER=${EXTEN})
exten = _X.,n,Set(FAXFROM=${IF($[${LEN(${CALLERID(num)})} > 0]?${CALLERID(num)}: Unknown)})
exten = _X.,n,Set(FAXFILE=/home/fax/${EXTEN}-${STRFTIME(,,%Y%m%d-%H%M)}-${RAND(1)}.tiff)
exten = _X.,n,ReceiveFAX(${FAXFILE})
exten = _X.,n,Set(SENDMAIL=1)
exten = _X.,n,System(/bin/ccsmtp mypbx@sina.com ${EMAILADDR_${MAILOWNER}} ${FAXFROM} ${FAXFILE})
exten = _X.,n,System(rm ${FAXFILE})
exten = _X.,n,Hangup()
exten = h,1,GotoIf($[${SENDMAIL}=0]?2:3)
exten = h,2,System(/bin/ccsmtp mypbx@sina.com ${EMAILADDR_${MAILOWNER}} ${FAXFROM} ${FAXFILE})
exten = h,3,System(rm ${FAXFILE})
exten = h,4,Hangup()
[t38-faxgateway-t30]
exten = 602,1,FaxGateway(DAHDI/77,${RINGTIME})
exten = 603,1,FaxGateway(DAHDI/78,${RINGTIME})
exten = 604,1,FaxGateway(DAHDI/75,${RINGTIME})
[detect-fax-to-email]
exten = s,1,NOOP(ready fax to ${FAXTOEMAIL_ADDR})
exten = s,n,GotoIf(${LEN(${FAX_TO_FXS})}>0?from-outside,${FAX_TO_FXS},1)
exten = s,n,Set(SENDMAIL=0)
exten = s,n,Set(FAXFROM=${IF($[${LEN(${CALLERID(num)})} > 0]?${CALLERID(num)}: Unknown)})
exten = s,n,Set(FAXFILE=/home/fax/${FAXFROM}-${STRFTIME(,,%Y%m%d-%H%M)}-${RAND(1)}.tiff)
exten = s,n,ReceiveFAX(${FAXFILE})
exten = s,n,Set(SENDMAIL=1)
exten = s,n,System(/bin/ccsmtp mypbx@sina.com ${FAXTOEMAIL_ADDR} ${FAXFROM} ${FAXFILE})
exten = s,n,System(rm ${FAXFILE})
exten = s,n,Hangup()
exten = h,1,GotoIf($[${SENDMAIL}=0]?2:3)
exten = h,2,System(/bin/ccsmtp mypbx@sina.com ${FAXTOEMAIL_ADDR} ${FAXFROM} ${FAXFILE})
exten = h,3,System(rm ${FAXFILE})
exten = h,4,Hangup()

[account-code-check]
exten = *89,1,NoOp(pin user check)
exten = *89,n,Answer
exten = *89,n,Read(userpin,record/pinuser-entry,10)
exten = *89,n,NoOp(${userpin})
exten = *89,n,Set(PINUSER_CONTEXT=${CONTEXT})
exten = *89,n,Set(TRANSFER_CONTEXT=${CONTEXT})
exten = *89,n,Goto(account-code-match,${userpin},1)
[account-code-match]
exten = i,1,Playback(record/pinuser-error)
exten = i,n,Hangup
[speed-dial-match]
exten = _*99.,1,Set(SdNum=${DB(speeddial/${EXTEN})})
exten = _*99.,n,GotoIf(${LEN(${SdNum})}>0?${CONTEXT},${SdNum},1)
[en-force-to-outside]
exten = *81,1,Answer
exten = *81,n,Set(DB(OfficeHours/ForceToOutside)=1)
exten = *81,n,GotoByTimeConditionBLFWork()
exten = *81,n,Wait(1)
exten = *81,n,Playback(beep)
exten = *81,n,Wait(1)
exten = *81,n,Hangup()
[dis-force-to-outside]
exten = *081,1,Answer
exten = *081,n,Set(DB(OfficeHours/ForceToOutside)=0)
exten = *081,n,GotoByTimeConditionBLFWork()
exten = *081,n,Wait(1)
exten = *081,n,Playback(beep)
exten = *081,n,Wait(1)
exten = *081,n,Hangup()
[en-force-to-inside]
exten = *82,1,Answer
exten = *82,n,Set(DB(OfficeHours/ForceToOutside)=2)
exten = *82,n,GotoByTimeConditionBLFWork()
exten = *82,n,Wait(1)
exten = *82,n,Playback(beep)
exten = *82,n,Wait(1)
exten = *82,n,Hangup()
[hintcontext]
include = park-hints
include = trunks-hintcontext
include = extensions-hintcontext
[trunks-hintcontext]
exten = pstn14,hint,DAHDI/76
exten = E1Trunk1,hint,DAHDI/g11
exten = E1Trunk2,hint,DAHDI/g12
exten = default,hint,SIP/trunk-sps-default
exten = 1,hint,SIP/trunk-sps-1
exten = 2,hint,SIP/trunk-sps-2
exten = 3,hint,SIP/trunk-sps-3
exten = 4,hint,SIP/trunk-sps-4
exten = 5,hint,SIP/trunk-sps-5
exten = TG400_20002,hint,SIP/trunk-TG400_20002
exten = TG400_20001,hint,SIP/trunk-TG400_20001
exten = test,hint,SIP/trunk-test

[extensions-hintcontext]
exten = 602,hint,DAHDI/77
exten = 603,hint,DAHDI/78
exten = 604,hint,DAHDI/75
exten = 258,hint,IAX2/258
exten = 259,hint,SIP/259&IAX2/259
exten = 100,hint,SIP/100
exten = 101,hint,SIP/101
exten = 102,hint,SIP/102
exten = 103,hint,SIP/103
exten = 104,hint,SIP/104
exten = 105,hint,SIP/105
exten = 106,hint,SIP/106
exten = 107,hint,SIP/107
exten = 108,hint,SIP/108
exten = 109,hint,SIP/109
exten = 110,hint,SIP/110
exten = 200,hint,SIP/200
exten = 201,hint,SIP/201
exten = 202,hint,SIP/202
exten = 203,hint,SIP/203
exten = 204,hint,SIP/204
exten = 205,hint,SIP/205
exten = 206,hint,SIP/206
exten = 207,hint,SIP/207
exten = 208,hint,SIP/208
exten = 209,hint,SIP/209
exten = 210,hint,SIP/210
exten = 211,hint,SIP/211
exten = 212,hint,SIP/212
exten = 213,hint,SIP/213
exten = 214,hint,SIP/214
exten = 215,hint,SIP/215
exten = 216,hint,SIP/216
exten = 217,hint,SIP/217
exten = 218,hint,SIP/218
exten = 219,hint,SIP/219
exten = 220,hint,SIP/220
exten = 221,hint,SIP/221
exten = 222,hint,SIP/222
exten = 223,hint,SIP/223
exten = 224,hint,SIP/224
exten = 256,hint,SIP/256
exten = 257,hint,SIP/257
[park-hints]
exten => 690,1,ParkedCall(690)
exten => 690,hint,park:690@parkedcalls
exten => 691,1,ParkedCall(691)
exten => 691,hint,park:691@parkedcalls
exten => 692,1,ParkedCall(692)
exten => 692,hint,park:692@parkedcalls
exten => 693,1,ParkedCall(693)
exten => 693,hint,park:693@parkedcalls
exten => 694,1,ParkedCall(694)
exten => 694,hint,park:694@parkedcalls
exten => 695,1,ParkedCall(695)
exten => 695,hint,park:695@parkedcalls
exten => 696,1,ParkedCall(696)
exten => 696,hint,park:696@parkedcalls
exten => 697,1,ParkedCall(697)
exten => 697,hint,park:697@parkedcalls
exten => 698,1,ParkedCall(698)
exten => 698,hint,park:698@parkedcalls

[mobile-exten-match]
[dynamic-threeway-invite]
exten = 0,1,noop(dynamic-threeway-invite)
exten = 0,n,Read(DEST,dial,,i)
exten = 0,n,Set(DYNAMIC_FEATURES=twinvite#twend)
exten = 0,n,Dial(Local/${DEST}@dynamic-threeway-dest,,g)
exten = 0,n,Set(DYNAMIC_FEATURES=)
exten = 0,n,Goto(dynamic-threeway,8600,1)
exten = i,1,Goto(dynamic-threeway,8600,1)

[dynamic-threeway-dest]
exten = _X.,1,noop(dynamic-threeway-dest)
exten = _X.,n,Dial(SIP/${EXTEN})

[dynamic-threeway]
exten = _XXXX,1,noop(dynamic-threeway)
exten = _XXXX,n,Answer
exten = _XXXX,n,Set(MEETME_EXIT_CONTEXT=dynamic-threeway-invite)
exten = _XXXX,n,Set(DYNAMIC_FEATURES=twinvite#twend)
exten = _XXXX,n,MeetMe(${EXTEN},pdMX)
exten = _XXXX,n,Set(DYNAMIC_FEATURES=)
exten = _XXXX,n,Hangup

[macro-mtwstart]
exten = s,1,noop(macro-mtwstart)
exten = s,n,Set(CONFNO=8600)
exten = s,n,ChannelRedirect(${BRIDGEPEER},dynamic-threeway,${CONFNO},1)
exten = s,n,Read(DEST,Dial,,i)
exten = s,n,Set(DYNAMIC_FEATURES=twinvite#twend)
exten = s,n,Dial(Local/${DEST}@dynamic-threeway-dest,,gtT)
exten = s,n,Set(DYNAMIC_FEATURES=)
exten = s,n,MeetMe(${CONFNO},pdMX)
exten = s,n,Goto(dynamic-threeway,${CONFNO},1)

[macro-mtwinvite]
exten = s,1,noop(macro-mthreeway-inv)
exten = s,n,ChannelRedirect(${BRIDGEPEER},dynamic-threeway,8600,1)

[macro-mtwend]
exten = s,1,noop(macro-mthreeway-noinv)
exten = s,n,SoftHangup(${BRIDGEPEER})

[cti-conference]
exten = _.,1,MeetMe(${EXTEN},Ms)

[cti-playfile]
exten = _.,1,Playback(${var1})
exten = _.,n,Hangup

[fax-extens]

[dial-ip-call]
exten = _X.,1,Dial(SIP/${DIALIP}/${EXTEN},${RINGTIME},${DIALOPTIONS})
exten = _X.,2,Hangup()
[dial-auto-answer]
exten = _X.,1,SIPAddHeader(Alert-Info:Ring Answer)
exten = _X.,n,SIPAddHeader(Call-Info:<uri>\;answer-after=0)
exten = _X.,n,Dial(${DIALPARAM_OF_EXTEN${EXTEN}},${RINGTIME},${DIALOPTIONS})
exten = _X.,n,Hangup
exten = h,1,Hangup
[pbxapi-normal-spy]
exten = _wormalX.,1,Noop(going to spy)
 same = n,GotoIf(${DB_EXISTS(allowspy/${EXTEN:6})}?:chanspy-invalid,s,1)
 same = n,Answer
 same = n,Wait(1)
 same = n,ChanSpy(${SPYCHANNELPREFIX},q)
 same = n,Hangup
[pbxapi-whisper-spy]
exten = _whisperX.,1,Noop(going to spy)
 same = n,GotoIf(${DB_EXISTS(allowspy/${EXTEN:7})}?:chanspy-invalid,s,1)
 same = n,Answer
 same = n,Wait(1)
 same = n,ChanSpy(${SPYCHANNELPREFIX},q)
 same = n,Hangup
[pbxapi-barge-spy]
exten = _barge.,1,Noop(going to spy)
 same = n,GotoIf(${DB_EXISTS(allowspy/${EXTEN:5})}?:chanspy-invalid,s,1)
 same = n,Answer
 same = n,Wait(1)
 same = n,ChanSpy(${SPYCHANNELPREFIX},Bq)
 same = n,Hangup

